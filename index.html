<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>æˆ‘çš„è¯—å¥æ”¶è—</title>
    <style>
      :root {
        --main-color: #3498db; /* é»˜è®¤ä¸»é¢˜é¢œè‰² */
      }

      body {
        background-color: #fdfdfd;
        color: var(--main-color);
      }

      .sidebar {
        background-color: var(--main-color);
        color: white;
      }

      .button {
        background-color: var(--main-color);
        border: none;
        color: white;
        padding: 8px 16px;
        cursor: pointer;
        border-radius: 5px;
      }
    </style>

    <style>
      :root {
        --bg-color: #fffbe6;
        --text-color: #333333;
        --header-bg: #ffd54f;
        --header-text: #333333;
        --button-bg: #ffa000;
        --button-hover-bg: #ff6f00;
        --card-bg: #ffffff;
        --card-shadow: #ccc;
        --card-hover-shadow: #ffca28;
      }

      /* é‡ç½®åŠåŸºç¡€ */
      * {
        box-sizing: border-box;
      }

      body {
        background: var(--bg-color);
        color: var(--text-color);
      }

      header {
        background: var(--header-bg);
        color: var(--header-text);
      }

      /* æŒ‰é’®èƒŒæ™¯ */
      #toggleAddFormBtn,
      #addPoemForm button[type="submit"] {
        background: var(--button-bg);
        color: white;
      }

      #toggleAddFormBtn:hover,
      #addPoemForm button[type="submit"]:hover {
        background: var(--button-hover-bg);
      }

      /* è¯—å¥å¡ç‰‡èƒŒæ™¯å’Œé˜´å½± */
      .poem-card {
        background: var(--card-bg);
        box-shadow: 0 0 6px var(--card-shadow);
      }

      .poem-card:hover {
        box-shadow: 0 0 10px var(--card-hover-shadow);
      }

      /* ä¾§è¾¹æ èƒŒæ™¯ */
      #drawer {
        background: var(--bg-color);
      }
    </style>
  </head>

  <body>
    <header>
      <button id="menuBtn" aria-label="æ‰“å¼€èœå•">â˜°</button>
      <h1>æˆ‘çš„è¯—å¥æ”¶è—</h1>
    </header>
    <div style="margin: 1em 0">
      <label for="themeColor">ğŸ¨ é€‰æ‹©ä¸»é¢˜é¢œè‰²ï¼š</label>
      <select id="themeColor" class="button">
        <option value="#3498db">å¤©ç©ºè“</option>
        <option value="#e74c3c">çƒ­æƒ…çº¢</option>
        <option value="#2ecc71">æ¸…æ–°ç»¿</option>
        <option value="#9b59b6">æ¢¦å¹»ç´«</option>
        <option value="#f39c12">æ©˜å­é»„</option>
      </select>
    </div>

    <div id="drawer" aria-hidden="true">
      <h2>èœå•</h2>
      <nav>
        <button data-page="home" class="active">é¦–é¡µ</button>
        <button data-page="categories">åˆ†ç±»</button>
        <button data-page="allPoems">å…¨éƒ¨è¯—å¥</button>
        <button data-page="authors">ä½œè€…</button>
      </nav>
    </div>

    <main id="mainContent">
      <!-- é¦–é¡µå†…å®¹ -->
      <div id="page-home">
        <input
          class="search-bar"
          type="text"
          id="searchInput"
          placeholder="æœç´¢è¯—å¥æˆ–ä½œè€…..."
        />

        <button id="toggleAddFormBtn">æ·»åŠ æ–°è¯—å¥</button>

        <form id="addPoemForm">
          <label for="newLine">è¯—å¥æ‘˜å½•</label>
          <input
            type="text"
            id="newLine"
            required
            placeholder="è¯·è¾“å…¥ä½ å–œæ¬¢çš„è¯—å¥"
          />

          <label for="newTitle">åŸè¯—æ ‡é¢˜</label>
          <input type="text" id="newTitle" required placeholder="åŸè¯—åç§°" />

          <label for="newAuthor">ä½œè€…</label>
          <input type="text" id="newAuthor" required placeholder="è¯—æ­Œä½œè€…" />

          <label for="newCategory">åˆ†ç±»</label>
          <select id="newCategory" required>
            <option disabled selected>è¯·é€‰æ‹©åˆ†ç±»</option>
          </select>

          <label for="newFull">å…¨æ–‡</label>
          <textarea
            id="newFull"
            rows="5"
            required
            placeholder="è¾“å…¥å®Œæ•´è¯—æ–‡"
          ></textarea>

          <button type="submit">æ·»åŠ è¯—å¥</button>
        </form>

        <div id="poemList"></div>
      </div>

      <!-- åˆ†ç±»é¡µå†…å®¹ -->
      <div id="page-categories" style="display: none">
        <h2>åˆ†ç±»åˆ—è¡¨</h2>
        <ul id="categoryList"></ul>
      </div>

      <!-- å…¨éƒ¨è¯—å¥é¡µå†…å®¹ -->
      <div id="page-allPoems" style="display: none">
        <h2>å…¨éƒ¨è¯—å¥</h2>
        <div id="allPoemList"></div>
      </div>

      <!-- ä½œè€…é¡µå†…å®¹ -->
      <div id="page-authors" style="display: none">
        <h2>ä½œè€…åˆ—è¡¨</h2>
        <div id="authorList"></div>
      </div>
    </main>

    <script>
      let poems = JSON.parse(localStorage.getItem("poems")) || [
        {
          id: 1,
          line: "åºŠå‰æ˜æœˆå…‰",
          title: "é™å¤œæ€",
          author: "æç™½",
          category: "æŠ’æƒ…",
          full: "åºŠå‰æ˜æœˆå…‰ï¼Œç–‘æ˜¯åœ°ä¸Šéœœã€‚\nä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡ã€‚",
        },
      ];

      const menuBtn = document.getElementById("menuBtn");
      const drawer = document.getElementById("drawer");
      const mainContent = document.getElementById("mainContent");
      const toggleAddFormBtn = document.getElementById("toggleAddFormBtn");
      const addPoemForm = document.getElementById("addPoemForm");
      const newCategorySelect = document.getElementById("newCategory");

      // é¡µé¢åŒºå—
      const pages = {
        home: document.getElementById("page-home"),
        categories: document.getElementById("page-categories"),
        allPoems: document.getElementById("page-allPoems"),
        authors: document.getElementById("page-authors"),
      };

      // æ‰“å¼€å…³é—­ä¾§è¾¹æ 
      menuBtn.addEventListener("click", () => {
        const opened = drawer.classList.toggle("open");
        mainContent.classList.toggle("shifted", opened);
        drawer.setAttribute("aria-hidden", !opened);
      });

      // èœå•æŒ‰é’®åˆ‡æ¢é¡µé¢
      drawer.querySelectorAll("nav button").forEach((btn) => {
        btn.addEventListener("click", () => {
          // åˆ‡æ¢æŒ‰é’®é«˜äº®
          drawer
            .querySelectorAll("nav button")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");

          // éšè—æ‰€æœ‰é¡µé¢ï¼Œæ˜¾ç¤ºå½“å‰é€‰ä¸­
          Object.values(pages).forEach((page) => (page.style.display = "none"));
          const pageKey = btn.getAttribute("data-page");
          pages[pageKey].style.display = "block";

          // å…³é—­æŠ½å±‰
          drawer.classList.remove("open");
          mainContent.classList.remove("shifted");
          drawer.setAttribute("aria-hidden", "true");

          // æ¸²æŸ“å¯¹åº”é¡µé¢å†…å®¹
          if (pageKey === "home") {
            renderPoems();
          } else if (pageKey === "categories") {
            renderCategoryListWithPoems();
          } else if (pageKey === "allPoems") {
            renderAllPoems();
          } else if (pageKey === "authors") {
            renderAuthorsWithPoems();
          }
        });
      });

      // åˆ‡æ¢æ–°å¢è¯—å¥è¡¨å•æ˜¾ç¤º
      toggleAddFormBtn.addEventListener("click", () => {
        if (addPoemForm.style.display === "block") {
          addPoemForm.style.display = "none";
          toggleAddFormBtn.textContent = "æ·»åŠ æ–°è¯—å¥";
        } else {
          addPoemForm.style.display = "block";
          toggleAddFormBtn.textContent = "æ”¶èµ·è¡¨å•";
        }
      });

      // è¯—å¥æ•°æ®ä¿æŒä¸å˜ï¼Œç•¥

      // é¦–é¡µè¯—å¥æ¸²æŸ“ï¼ˆå¸¦æœç´¢ï¼‰
      const poemList = document.getElementById("poemList");
      const searchInput = document.getElementById("searchInput");

      function renderPoems() {
        poemList.innerHTML = "";
        const keyword = searchInput.value.trim().toLowerCase();

        const filtered = poems.filter((poem) => {
          return (
            poem.line.toLowerCase().includes(keyword) ||
            poem.title.toLowerCase().includes(keyword) ||
            poem.author.toLowerCase().includes(keyword)
          );
        });

        if (filtered.length === 0) {
          poemList.innerHTML = "<p>æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è¯—å¥ã€‚</p>";
          return;
        }

        filtered.forEach((poem) => {
          const card = createPoemCard(poem);
          poemList.appendChild(card);
        });
      }

      // åˆ›å»ºè¯—å¥å¡ç‰‡ï¼Œå…¨æ–‡ç‚¹å‡»å±•å¼€
      function createPoemCard(poem) {
        const card = document.createElement("div");
        card.className = "poem-card";
        card.innerHTML = `
    <div class="poem-line">${poem.line}</div>
    <div class="poem-title">${poem.title} â€” ${poem.author}</div>
    <div class="poem-full" style="display:none;">${poem.full}</div>
  `;
        card.addEventListener("click", () => {
          const full = card.querySelector(".poem-full");
          full.style.display =
            full.style.display === "block" ? "none" : "block";
        });
        return card;
      }

      // å…¨éƒ¨è¯—å¥é¡µæ¸²æŸ“
      const allPoemList = document.getElementById("allPoemList");
      function renderAllPoems() {
        allPoemList.innerHTML = "";
        poems.forEach((poem) => {
          const card = createPoemCard(poem);
          allPoemList.appendChild(card);
        });
      }

      // åˆ†ç±»é¡µ - æ˜¾ç¤ºåˆ†ç±»åˆ—è¡¨ï¼Œå¹¶å¯ç‚¹å±•å¼€æŸ¥çœ‹è¯¥åˆ†ç±»è¯—å¥
      const categoryList = document.getElementById("categoryList");

      function renderCategoryListWithPoems() {
        categoryList.innerHTML = "";
        categories.forEach((cat) => {
          const li = document.createElement("li");
          li.style.cursor = "pointer";
          li.textContent = cat;

          // ç‚¹å¼€æ˜¾ç¤ºè¯¥åˆ†ç±»çš„è¯—å¥
          li.addEventListener("click", () => {
            renderCategoryPoems(cat);
          });

          categoryList.appendChild(li);
        });

        // é»˜è®¤å±•ç¤ºç¬¬ä¸€ä¸ªåˆ†ç±»è¯—å¥
        if (categories.length > 0) renderCategoryPoems(categories[0]);
      }

      function renderCategoryPoems(category) {
        // å…ˆæ¸…ç©ºåˆ†ç±»åˆ—è¡¨ï¼Œå˜æˆåŒ…å«è¯—å¥è¯¦æƒ…
        categoryList.innerHTML = "";

        // æ·»åŠ ä¸€ä¸ªè¿”å›æŒ‰é’®ï¼Œå›åˆ°åˆ†ç±»åˆ—è¡¨
        const backBtn = document.createElement("button");
        backBtn.textContent = "â† è¿”å›åˆ†ç±»åˆ—è¡¨";
        backBtn.style.marginBottom = "10px";
        backBtn.addEventListener("click", renderCategoryListWithPoems);
        categoryList.appendChild(backBtn);

        // æ˜¾ç¤ºå½“å‰åˆ†ç±»æ ‡é¢˜
        const header = document.createElement("h3");
        header.textContent = `åˆ†ç±»ï¼š${category}`;
        categoryList.appendChild(header);

        // æ˜¾ç¤ºè¯¥åˆ†ç±»çš„æ‰€æœ‰è¯—å¥
        const poemsInCategory = poems.filter((p) => p.category === category);
        if (poemsInCategory.length === 0) {
          const p = document.createElement("p");
          p.textContent = "è¯¥åˆ†ç±»ä¸‹æš‚æ— è¯—å¥ã€‚";
          categoryList.appendChild(p);
        } else {
          poemsInCategory.forEach((poem) => {
            const card = createPoemCard(poem);
            categoryList.appendChild(card);
          });
        }
      }

      // ä½œè€…é¡µ - æ˜¾ç¤ºä½œè€…åˆ—è¡¨ï¼Œå¯ç‚¹å¼€æŸ¥çœ‹ä½œè€…çš„è¯—å¥
      const authorListDiv = document.getElementById("authorList");

      function renderAuthorsWithPoems() {
        authorListDiv.innerHTML = "";

        // å»é‡ä½œè€…åˆ—è¡¨
        const authors = [...new Set(poems.map((p) => p.author))];

        // åˆ›å»ºä½œè€…æŒ‰é’®
        authors.forEach((author) => {
          const btn = document.createElement("button");
          btn.textContent = author;
          btn.style.margin = "5px 5px 10px 0";
          btn.style.padding = "6px 12px";
          btn.style.borderRadius = "20px";
          btn.style.border = "none";
          btn.style.cursor = "pointer";
          btn.style.backgroundColor = "#fff9d6";
          btn.addEventListener("click", () => {
            renderAuthorPoems(author);
          });
          authorListDiv.appendChild(btn);
        });
      }

      function renderAuthorPoems(author) {
        authorListDiv.innerHTML = "";

        // è¿”å›æŒ‰é’®
        const backBtn = document.createElement("button");
        backBtn.textContent = "â† è¿”å›ä½œè€…åˆ—è¡¨";
        backBtn.style.marginBottom = "10px";
        backBtn.addEventListener("click", renderAuthorsWithPoems);
        authorListDiv.appendChild(backBtn);

        // æ ‡é¢˜
        const header = document.createElement("h3");
        header.textContent = `ä½œè€…ï¼š${author}`;
        authorListDiv.appendChild(header);

        // æ˜¾ç¤ºä½œè€…æ‰€æœ‰è¯—å¥
        const poemsByAuthor = poems.filter((p) => p.author === author);
        if (poemsByAuthor.length === 0) {
          const p = document.createElement("p");
          p.textContent = "è¯¥ä½œè€…æš‚æ— è¯—å¥ã€‚";
          authorListDiv.appendChild(p);
        } else {
          poemsByAuthor.forEach((poem) => {
            const card = createPoemCard(poem);
            authorListDiv.appendChild(card);
          });
        }
      }

      // æ–°å¢è¯—å¥è¡¨å•æäº¤å¤„ç†ï¼ˆä¿æŒä¸å˜ï¼‰
      addPoemForm.addEventListener("submit", (e) => {
        e.preventDefault();

        const newLine = document.getElementById("newLine").value.trim();
        const newTitle = document.getElementById("newTitle").value.trim();
        const newAuthor = document.getElementById("newAuthor").value.trim();
        const newCategory = document.getElementById("newCategory").value;
        const newFull = document.getElementById("newFull").value.trim();

        if (!newLine || !newTitle || !newAuthor || !newCategory || !newFull) {
          alert("è¯·å¡«å†™æ‰€æœ‰å­—æ®µï¼");
          return;
        }

        const newId =
          poems.length > 0 ? Math.max(...poems.map((p) => p.id)) + 1 : 1;

        poems.push({
          id: newId,
          line: newLine,
          title: newTitle,
          author: newAuthor,
          category: newCategory,
          full: newFull,
        });

        localStorage.setItem("poems", JSON.stringify(poems));

        // æ›´æ–°æ‰€æœ‰é¡µé¢å†…å®¹
        renderPoems();
        renderAllPoems();
        renderAuthorsWithPoems();
        renderCategoryListWithPoems();

        addPoemForm.reset();
        addPoemForm.style.display = "none";
        toggleAddFormBtn.textContent = "æ·»åŠ æ–°è¯—å¥";
      });

      // åˆ†ç±»æ•°æ®
      let categories = JSON.parse(localStorage.getItem("categories")) || [
        "æŠ’æƒ…",
        "å±±æ°´",
        "æ€ä¹¡",
        "çˆ±æƒ…",
      ];

      // ä¿å­˜åˆ†ç±»åˆ°æœ¬åœ°
      function saveCategories() {
        localStorage.setItem("categories", JSON.stringify(categories));
      }

      // æ¸²æŸ“åˆ†ç±»ä¸‹æ‹‰é€‰é¡¹ï¼ˆç»™æ–°å¢è¯—å¥è¡¨å•ç”¨ï¼‰
      function renderCategoryOptions() {
        newCategorySelect.innerHTML =
          "<option disabled selected>è¯·é€‰æ‹©åˆ†ç±»</option>";
        categories.forEach((cat) => {
          const option = document.createElement("option");
          option.value = cat;
          option.textContent = cat;
          newCategorySelect.appendChild(option);
        });
      }

      // æœç´¢æ¡†ç›‘å¬
      searchInput.addEventListener("input", renderPoems);

      // åˆå§‹åŒ–åˆ†ç±»é€‰é¡¹ï¼Œé¦–é¡µè¯—å¥ï¼Œå…¨éƒ¨è¯—å¥ï¼Œä½œè€…åˆ—è¡¨
      renderCategoryOptions();
      renderPoems();
      renderAllPoems();
      renderAuthorsWithPoems();
    </script>
    <script>
      const themeColorSelect = document.getElementById("themeColor");
      themeColorSelect.addEventListener("change", function () {
        document.documentElement.style.setProperty(
          "--main-color",
          themeColorSelect.value,
        );

        document.documentElement.style.setProperty("--main-color", this.value);
      });
    </script>
  </body>
</html>
