<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>我的诗句收藏</title>
    <style>
      /* 重置及基础 */
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #fffbe6;
        color: #333;
        overflow-x: hidden;
        /* 防止横向滚动 */
      }

      /* 顶部菜单栏 */
      header {
        background: #ffd54f;
        padding: 10px 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      #menuBtn {
        font-size: 24px;
        cursor: pointer;
        background: none;
        border: none;
        user-select: none;
      }

      header h1 {
        margin: 0;
        font-size: 1.5rem;
        flex-grow: 1;
        text-align: center;
      }

      /* 侧边栏抽屉 */
      #drawer {
        position: fixed;
        top: 0;
        left: -250px;
        width: 250px;
        height: 100vh;
        background: #fff9d6;
        box-shadow: 2px 0 8px rgba(0, 0, 0, 0.15);
        padding: 20px;
        transition: left 0.3s ease;
        z-index: 1000;
        display: flex;
        flex-direction: column;
      }

      #drawer.open {
        left: 0;
      }

      #drawer h2 {
        margin-top: 0;
        margin-bottom: 1rem;
      }

      #drawer nav button {
        background: none;
        border: none;
        padding: 10px;
        text-align: left;
        width: 100%;
        font-size: 1rem;
        cursor: pointer;
        border-radius: 5px;
        margin-bottom: 5px;
        transition: background-color 0.2s;
      }

      #drawer nav button:hover,
      #drawer nav button.active {
        background-color: #ffd54f;
      }

      /* 主体内容区域 */
      main {
        padding: 20px;
        max-width: 600px;
        margin: 0 auto;
        transition: margin-left 0.3s ease;
      }

      main.shifted {
        margin-left: 250px;
      }

      /* 搜索框 */
      .search-bar {
        margin-bottom: 20px;
        width: 100%;
        padding: 8px;
        font-size: 16px;
        border-radius: 6px;
        border: 1px solid #ccc;
      }

      /* 诗句卡片 */
      .poem-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 0 6px #ccc;
        padding: 15px;
        margin-bottom: 15px;
        cursor: pointer;
        transition: box-shadow 0.3s;
      }

      .poem-card:hover {
        box-shadow: 0 0 10px #ffca28;
      }

      .poem-line {
        font-weight: bold;
        font-size: 18px;
      }

      .poem-title {
        font-style: italic;
        color: #666;
        margin-top: 6px;
      }

      .poem-full {
        margin-top: 10px;
        white-space: pre-wrap;
        display: none;
        border-top: 1px solid #eee;
        padding-top: 10px;
        color: #444;
      }

      /* 折叠表单按钮 */
      #toggleAddFormBtn {
        background: #ffa000;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 6px;
        cursor: pointer;
        margin-bottom: 10px;
        font-size: 16px;
        width: 100%;
        transition: background-color 0.3s;
      }

      #toggleAddFormBtn:hover {
        background: #ff6f00;
      }

      /* 添加诗句表单 - 默认隐藏 */
      #addPoemForm {
        background: #fff9d6;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 0 6px #ffd54f;
        margin-bottom: 30px;
        display: none;
      }

      #addPoemForm label {
        font-weight: bold;
        display: block;
        margin-top: 10px;
      }

      #addPoemForm input[type="text"],
      #addPoemForm select,
      #addPoemForm textarea {
        width: 100%;
        padding: 8px;
        font-size: 16px;
        border-radius: 6px;
        border: 1px solid #ccc;
        margin-top: 5px;
        margin-bottom: 15px;
        resize: vertical;
        box-sizing: border-box;
      }

      #addPoemForm button[type="submit"] {
        background: #ffa000;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        width: 100%;
        transition: background-color 0.3s;
      }

      #addPoemForm button[type="submit"]:hover {
        background: #ff6f00;
      }

      /* 作者列表 */
      #authorList {
        margin-top: 10px;
      }

      #authorList div {
        padding: 8px;
        background: white;
        border-radius: 6px;
        margin-bottom: 6px;
        cursor: pointer;
        box-shadow: 0 0 5px #ccc;
        transition: background-color 0.2s;
      }

      #authorList div:hover {
        background: #ffd54f;
        color: white;
      }
    </style>
  </head>

  <body>
    <header>
      <button id="menuBtn" aria-label="打开菜单">☰</button>
      <h1>我的诗句收藏</h1>
    </header>

    <div id="drawer" aria-hidden="true">
      <h2>菜单</h2>
      <nav>
        <button data-page="home" class="active">首页</button>
        <button data-page="categories">分类</button>
        <button data-page="allPoems">全部诗句</button>
        <button data-page="authors">作者</button>
      </nav>
    </div>

    <main id="mainContent">
      <!-- 首页内容 -->
      <div id="page-home">
        <input
          class="search-bar"
          type="text"
          id="searchInput"
          placeholder="搜索诗句或作者..."
        />

        <button id="toggleAddFormBtn">添加新诗句</button>

        <form id="addPoemForm">
          <label for="newLine">诗句摘录</label>
          <input
            type="text"
            id="newLine"
            required
            placeholder="请输入你喜欢的诗句"
          />

          <label for="newTitle">原诗标题</label>
          <input type="text" id="newTitle" required placeholder="原诗名称" />

          <label for="newAuthor">作者</label>
          <input type="text" id="newAuthor" required placeholder="诗歌作者" />

          <label for="newCategory">分类</label>
          <select id="newCategory" required>
            <option disabled selected>请选择分类</option>
          </select>

          <label for="newFull">全文</label>
          <textarea
            id="newFull"
            rows="5"
            required
            placeholder="输入完整诗文"
          ></textarea>

          <button type="submit">添加诗句</button>
        </form>

        <div id="poemList"></div>
      </div>

      <!-- 分类页内容 -->
      <div id="page-categories" style="display: none">
        <h2>分类列表</h2>
        <ul id="categoryList"></ul>
      </div>

      <!-- 全部诗句页内容 -->
      <div id="page-allPoems" style="display: none">
        <h2>全部诗句</h2>
        <div id="allPoemList"></div>
      </div>

      <!-- 作者页内容 -->
      <div id="page-authors" style="display: none">
        <h2>作者列表</h2>
        <div id="authorList"></div>
      </div>
    </main>

    <script>
      const menuBtn = document.getElementById("menuBtn");
      const drawer = document.getElementById("drawer");
      const mainContent = document.getElementById("mainContent");
      const toggleAddFormBtn = document.getElementById("toggleAddFormBtn");
      const addPoemForm = document.getElementById("addPoemForm");
      const newCategorySelect = document.getElementById("newCategory");

      // 页面区块
      const pages = {
        home: document.getElementById("page-home"),
        categories: document.getElementById("page-categories"),
        allPoems: document.getElementById("page-allPoems"),
        authors: document.getElementById("page-authors"),
      };

      // 打开关闭侧边栏
      menuBtn.addEventListener("click", () => {
        const opened = drawer.classList.toggle("open");
        mainContent.classList.toggle("shifted", opened);
        drawer.setAttribute("aria-hidden", !opened);
      });

      // 菜单按钮切换页面
      drawer.querySelectorAll("nav button").forEach((btn) => {
        btn.addEventListener("click", () => {
          // 切换按钮高亮
          drawer
            .querySelectorAll("nav button")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");

          // 隐藏所有页面，显示当前选中
          Object.values(pages).forEach((page) => (page.style.display = "none"));
          const pageKey = btn.getAttribute("data-page");
          pages[pageKey].style.display = "block";

          // 关闭抽屉
          drawer.classList.remove("open");
          mainContent.classList.remove("shifted");
          drawer.setAttribute("aria-hidden", "true");

          // 渲染对应页面内容
          if (pageKey === "home") {
            renderPoems();
          } else if (pageKey === "categories") {
            renderCategoryListWithPoems();
          } else if (pageKey === "allPoems") {
            renderAllPoems();
          } else if (pageKey === "authors") {
            renderAuthorsWithPoems();
          }
        });
      });

      // 切换新增诗句表单显示
      toggleAddFormBtn.addEventListener("click", () => {
        if (addPoemForm.style.display === "block") {
          addPoemForm.style.display = "none";
          toggleAddFormBtn.textContent = "添加新诗句";
        } else {
          addPoemForm.style.display = "block";
          toggleAddFormBtn.textContent = "收起表单";
        }
      });

      // 诗句数据保持不变，略

      // 首页诗句渲染（带搜索）
      const poemList = document.getElementById("poemList");
      const searchInput = document.getElementById("searchInput");

      function renderPoems() {
        poemList.innerHTML = "";
        const keyword = searchInput.value.trim().toLowerCase();

        const filtered = poems.filter((poem) => {
          return (
            poem.line.toLowerCase().includes(keyword) ||
            poem.title.toLowerCase().includes(keyword) ||
            poem.author.toLowerCase().includes(keyword)
          );
        });

        if (filtered.length === 0) {
          poemList.innerHTML = "<p>没有找到符合条件的诗句。</p>";
          return;
        }

        filtered.forEach((poem) => {
          const card = createPoemCard(poem);
          poemList.appendChild(card);
        });
      }

      // 创建诗句卡片，全文点击展开
      function createPoemCard(poem) {
        const card = document.createElement("div");
        card.className = "poem-card";
        card.innerHTML = `
    <div class="poem-line">${poem.line}</div>
    <div class="poem-title">${poem.title} — ${poem.author}</div>
    <div class="poem-full" style="display:none;">${poem.full}</div>
  `;
        card.addEventListener("click", () => {
          const full = card.querySelector(".poem-full");
          full.style.display =
            full.style.display === "block" ? "none" : "block";
        });
        return card;
      }

      // 全部诗句页渲染
      const allPoemList = document.getElementById("allPoemList");
      function renderAllPoems() {
        allPoemList.innerHTML = "";
        poems.forEach((poem) => {
          const card = createPoemCard(poem);
          allPoemList.appendChild(card);
        });
      }

      // 分类页 - 显示分类列表，并可点展开查看该分类诗句
      const categoryList = document.getElementById("categoryList");

      function renderCategoryListWithPoems() {
        categoryList.innerHTML = "";
        categories.forEach((cat) => {
          const li = document.createElement("li");
          li.style.cursor = "pointer";
          li.textContent = cat;

          // 点开显示该分类的诗句
          li.addEventListener("click", () => {
            renderCategoryPoems(cat);
          });

          categoryList.appendChild(li);
        });

        // 默认展示第一个分类诗句
        if (categories.length > 0) renderCategoryPoems(categories[0]);
      }

      function renderCategoryPoems(category) {
        // 先清空分类列表，变成包含诗句详情
        categoryList.innerHTML = "";

        // 添加一个返回按钮，回到分类列表
        const backBtn = document.createElement("button");
        backBtn.textContent = "← 返回分类列表";
        backBtn.style.marginBottom = "10px";
        backBtn.addEventListener("click", renderCategoryListWithPoems);
        categoryList.appendChild(backBtn);

        // 显示当前分类标题
        const header = document.createElement("h3");
        header.textContent = `分类：${category}`;
        categoryList.appendChild(header);

        // 显示该分类的所有诗句
        const poemsInCategory = poems.filter((p) => p.category === category);
        if (poemsInCategory.length === 0) {
          const p = document.createElement("p");
          p.textContent = "该分类下暂无诗句。";
          categoryList.appendChild(p);
        } else {
          poemsInCategory.forEach((poem) => {
            const card = createPoemCard(poem);
            categoryList.appendChild(card);
          });
        }
      }

      // 作者页 - 显示作者列表，可点开查看作者的诗句
      const authorListDiv = document.getElementById("authorList");

      function renderAuthorsWithPoems() {
        authorListDiv.innerHTML = "";

        // 去重作者列表
        const authors = [...new Set(poems.map((p) => p.author))];

        // 创建作者按钮
        authors.forEach((author) => {
          const btn = document.createElement("button");
          btn.textContent = author;
          btn.style.margin = "5px 5px 10px 0";
          btn.style.padding = "6px 12px";
          btn.style.borderRadius = "20px";
          btn.style.border = "none";
          btn.style.cursor = "pointer";
          btn.style.backgroundColor = "#fff9d6";
          btn.addEventListener("click", () => {
            renderAuthorPoems(author);
          });
          authorListDiv.appendChild(btn);
        });
      }

      function renderAuthorPoems(author) {
        authorListDiv.innerHTML = "";

        // 返回按钮
        const backBtn = document.createElement("button");
        backBtn.textContent = "← 返回作者列表";
        backBtn.style.marginBottom = "10px";
        backBtn.addEventListener("click", renderAuthorsWithPoems);
        authorListDiv.appendChild(backBtn);

        // 标题
        const header = document.createElement("h3");
        header.textContent = `作者：${author}`;
        authorListDiv.appendChild(header);

        // 显示作者所有诗句
        const poemsByAuthor = poems.filter((p) => p.author === author);
        if (poemsByAuthor.length === 0) {
          const p = document.createElement("p");
          p.textContent = "该作者暂无诗句。";
          authorListDiv.appendChild(p);
        } else {
          poemsByAuthor.forEach((poem) => {
            const card = createPoemCard(poem);
            authorListDiv.appendChild(card);
          });
        }
      }

      // 新增诗句表单提交处理（保持不变）
      addPoemForm.addEventListener("submit", (e) => {
        e.preventDefault();

        const newLine = document.getElementById("newLine").value.trim();
        const newTitle = document.getElementById("newTitle").value.trim();
        const newAuthor = document.getElementById("newAuthor").value.trim();
        const newCategory = document.getElementById("newCategory").value;
        const newFull = document.getElementById("newFull").value.trim();

        if (!newLine || !newTitle || !newAuthor || !newCategory || !newFull) {
          alert("请填写所有字段！");
          return;
        }

        const newId =
          poems.length > 0 ? Math.max(...poems.map((p) => p.id)) + 1 : 1;

        poems.push({
          id: newId,
          line: newLine,
          title: newTitle,
          author: newAuthor,
          category: newCategory,
          full: newFull,
        });

        localStorage.setItem("poems", JSON.stringify(poems));

        // 更新所有页面内容
        renderPoems();
        renderAllPoems();
        renderAuthorsWithPoems();
        renderCategoryListWithPoems();

        addPoemForm.reset();
        addPoemForm.style.display = "none";
        toggleAddFormBtn.textContent = "添加新诗句";
      });

      // 分类数据
      let categories = JSON.parse(localStorage.getItem("categories")) || [
        "抒情",
        "山水",
        "思乡",
        "爱情",
      ];

      // 保存分类到本地
      function saveCategories() {
        localStorage.setItem("categories", JSON.stringify(categories));
      }

      // 渲染分类下拉选项（给新增诗句表单用）
      function renderCategoryOptions() {
        newCategorySelect.innerHTML =
          "<option disabled selected>请选择分类</option>";
        categories.forEach((cat) => {
          const option = document.createElement("option");
          option.value = cat;
          option.textContent = cat;
          newCategorySelect.appendChild(option);
        });
      }

      // 搜索框监听
      searchInput.addEventListener("input", renderPoems);

      // 初始化分类选项，首页诗句，全部诗句，作者列表
      renderCategoryOptions();
      renderPoems();
      renderAllPoems();
      renderAuthorsWithPoems();
    </script>
  </body>
</html>
